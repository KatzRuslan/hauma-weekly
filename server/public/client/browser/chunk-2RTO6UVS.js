import{c as de}from"./chunk-MEDP6IYI.js";import{a as ye}from"./chunk-XGC7MIBL.js";import"./chunk-7BTGCGPX.js";import{a as Se,b as ke}from"./chunk-SOWXVAUG.js";import{b as xe,c as Ce,k as be,n as fe}from"./chunk-Y4Q22GGC.js";import{H as L,U as pe,X as ce,Z as ue,aa as z,ea as R,ia as v,ka as _e,la as me,ta as E,ua as S,wa as ge,x as re,xa as he,z as se}from"./chunk-AR5P2KL7.js";import{Ab as ee,Bb as C,Cb as U,Cc as ae,Dc as T,I as q,Ia as K,Ib as M,Ja as G,Ma as J,Oa as X,Sb as te,Ua as _,Ub as ne,Wb as ie,Xb as oe,Za as V,Zb as le,cb as x,eb as O,gb as f,ia as P,ib as y,jb as I,ka as w,l as W,nb as s,ob as d,pa as p,pb as F,qa as c,tb as g,vb as m,wb as a,zb as Z}from"./chunk-QKGFT424.js";import{a as D,b as N,e as Q,f as B}from"./chunk-ZFMGZBFO.js";function Ue(r,u){if(r&1){let t=g();s(0,"p-calendar",1),m("ngModelChange",function(e){p(t);let l=a();return c(l.calendarValue=e)}),d(),s(1,"div",2)(2,"p-button",3),m("onClick",function(){p(t);let e=a();return c(e.changeValue())}),d(),s(3,"p-button",4),m("onClick",function(){p(t);let e=a();return c(e.changeMode(!1))}),d()()}if(r&2){let t=a();x("ngModel",t.calendarValue)("placeholder",t.placeholder)("inputStyleClass",t.inputStyleClass)("showIcon",!0),_(2),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)("disabled",!t.calendarValue||t.calendarValue==t.value),_(1),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)}}function Ae(r,u){if(r&1){let t=g();s(0,"div")(1,"span",5),C(2),te(3,"date"),d()(),s(4,"div",6)(5,"p-button",7),m("onClick",function(){p(t);let e=a();return c(e.changeMode(!0))}),d()()}if(r&2){let t=a();f(t.textStyleClass),_(2),U(ne(3,7,t.value,"dd-MMM-YYYY")),_(3),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)}}var Me=(()=>{let u=class u{constructor(){this.placeholder="Select Date",this.buttonStyleClass="table-icon-button",this.onValueChange=new V,this.onModeChange=new V}set _value(n){this.value=n?new Date(n):null}changeValue(){this.onValueChange.emit(this.calendarValue)}changeMode(n){n?this.calendarValue=this.value:this.calendarValue=null,this.onModeChange.emit(n)}};u.\u0275fac=function(e){return new(e||u)},u.\u0275cmp=w({type:u,selectors:[["app-editable-calendar"]],inputs:{_value:["value","_value"],mode:"mode",placeholder:"placeholder",styleClass:"styleClass",textStyleClass:"textStyleClass",inputStyleClass:"inputStyleClass",buttonStyleClass:"buttonStyleClass"},outputs:{onValueChange:"onValueChange",onModeChange:"onModeChange"},standalone:!0,features:[M],decls:3,vars:3,consts:[[1,"flex","align-items-center","hover-container",3,"document.keyup.esc"],["dateFormat","dd-M-yy","dataType","string","appendTo","body",3,"ngModel","placeholder","inputStyleClass","showIcon","ngModelChange"],[1,"flex","align-items-center","flex-nowrap","px-1"],["icon","pi pi-save",3,"styleClass","rounded","text","plain","disabled","onClick"],["icon","pi pi-times",3,"styleClass","rounded","text","plain","onClick"],[1,""],[1,"toggle-edit-mode-button-container","hover-source","px-1"],["icon","pi pi-pencil",3,"styleClass","rounded","text","plain","onClick"]],template:function(e,l){e&1&&(s(0,"div",0),m("document.keyup.esc",function(){return l.changeMode(!1)}),y(1,Ue,4,13)(2,Ae,6,10),d()),e&2&&(f(l.styleClass),_(1),I(1,l.mode?1:2))},dependencies:[T,ae,v,z,R,Ce,xe,E,S]});let r=u;return r})();function De(r,u){if(r&1){let t=g();s(0,"input",1),m("ngModelChange",function(e){p(t);let l=a();return c(l.inputValue=e)})("keyup.enter",function(){p(t);let e=a();return c(e.inputValue&&e.inputValue!=e.value?e.changeValue():void 0)}),d(),s(1,"div",2)(2,"p-button",3),m("onClick",function(){p(t);let e=a();return c(e.changeValue())}),d(),s(3,"p-button",4),m("onClick",function(){p(t);let e=a();return c(e.changeMode(!1))}),d()()}if(r&2){let t=a();f(t.inputStyleClass),x("ngModel",t.inputValue),_(2),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)("disabled",!t.inputValue||t.inputValue==t.value),_(1),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)}}function Pe(r,u){if(r&1&&(s(0,"a",9),C(1),d()),r&2){let t=a(2);x("href",t.link,J),_(1),U(t.value)}}function ze(r,u){if(r&1&&(s(0,"span",10),C(1),d()),r&2){let t=a(2);_(1),U(t.value)}}function Re(r,u){if(r&1){let t=g();s(0,"div",5),y(1,Pe,2,2,"a",6)(2,ze,2,1),d(),s(3,"div",7)(4,"p-button",8),m("onClick",function(){p(t);let e=a();return c(e.changeMode(!0))}),d()()}if(r&2){let t=a();f(t.textStyleClass),Z("pTooltip",t.value),x("tooltipPosition",t.tooltipPosition),_(1),I(1,t.link?1:2),_(3),x("styleClass",t.buttonStyleClass)("rounded",!0)("text",!0)("plain",!0)}}var Te=(()=>{let u=class u{constructor(){this.buttonStyleClass="table-icon-button",this.tooltipPosition="top",this.onValueChange=new V,this.onModeChange=new V}onKeyDown({key:n}){this.mode&&n.toLowerCase()==="escape"&&this.changeMode(!1)}changeValue(){this.onValueChange.emit(this.inputValue)}changeMode(n){this.inputValue=`${this.value}`,this.onModeChange.emit(n)}};u.\u0275fac=function(e){return new(e||u)},u.\u0275cmp=w({type:u,selectors:[["app-editable-text"]],hostBindings:function(e,l){e&1&&m("keydown",function(i){return l.onKeyDown(i)},!1,G)},inputs:{value:"value",mode:"mode",link:"link",styleClass:"styleClass",textStyleClass:"textStyleClass",inputStyleClass:"inputStyleClass",buttonStyleClass:"buttonStyleClass",tooltipPosition:"tooltipPosition"},outputs:{onValueChange:"onValueChange",onModeChange:"onModeChange"},standalone:!0,features:[M],decls:3,vars:3,consts:[[1,"flex","align-items-center","hover-container",3,"document.keyup.esc"],["type","text","pInputText","",3,"ngModel","ngModelChange","keyup.enter"],[1,"flex","align-items-center","flex-nowrap","px-1"],["icon","pi pi-save",3,"styleClass","rounded","text","plain","disabled","onClick"],["icon","pi pi-times",3,"styleClass","rounded","text","plain","onClick"],["appTooltip","",3,"pTooltip","tooltipPosition"],["target","_blank","class","text-color no-underline hover:underline",3,"href"],[1,"toggle-edit-mode-button-container","hover-source","px-1"],["icon","pi pi-pencil",3,"styleClass","rounded","text","plain","onClick"],["target","_blank",1,"text-color","no-underline","hover:underline",3,"href"],[1,""]],template:function(e,l){e&1&&(s(0,"div",0),m("document.keyup.esc",function(){return l.changeMode(!1)}),y(1,De,4,12)(2,Re,5,9),d()),e&2&&(f(l.styleClass),_(1),I(1,l.mode?1:2))},dependencies:[T,v,ue,z,R,me,_e,S,E,he,ge,ye]});let r=u;return r})();var ve=Q(Se()),Ee=Q(ke());var je=["table"];function Be(r,u){if(r&1){let t=g();s(0,"div",6)(1,"label",7),F(2,"span",8),s(3,"input",9,10),m("change",function(){p(t);let e=ee(4),l=a();return c(l.fileLoad(e.files))}),d()()()}}function Oe(r,u){if(r&1){let t=g();s(0,"div",6)(1,"p-button",11),m("onClick",function(){p(t);let e=a();return c(e.onMessage(e.messageType.UploadArticles))}),d()()}if(r&2){let t=a();_(1),x("disabled",t.isDisabled)("rounded",!0)("rounded",!0)("plain",!0)}}function Fe(r,u){r&1&&(s(0,"tr",12)(1,"th",13)(2,"div",14)(3,"span",12),C(4,"Date / Issue Date"),d()()(),s(5,"th",15)(6,"div",14)(7,"span",12),C(8,"Type / Featured"),d()()(),s(9,"th",16)(10,"div",14)(11,"span",12),C(12,"Category / Source"),d()()(),s(13,"th",17)(14,"div",14)(15,"span",12),C(16,"Author / Autor Link"),d()()(),s(17,"th",18)(18,"div",14)(19,"span",12),C(20,"Title / Post Link"),d()()(),s(21,"th",19)(22,"div",14)(23,"span",12),C(24,"Subject"),d()()()())}function Le(r,u){if(r&1){let t=g();s(0,"tr",20)(1,"td",13)(2,"app-editable-calendar",21),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{date:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"date":""))}),d()(),s(3,"td",15)(4,"app-editable-text",22),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{articleType:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"articleType":""))}),d()(),s(5,"td",16)(6,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{category:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"category":""))}),d()(),s(7,"td",17)(8,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{author:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"author":""))}),d()(),s(9,"td",18)(10,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{title:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"title":""))}),d()(),s(11,"td",19)(12,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{subject:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"subject":""))}),d()()(),s(13,"tr",12)(14,"td",13)(15,"app-editable-calendar",21),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{edition:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"edition":""))}),d()(),s(16,"td",15)(17,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{featured:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"featured":""))}),d()(),s(18,"td",16)(19,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{source:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"source":""))}),d()(),s(20,"td",17)(21,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{authorLink:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"authorLink":""))}),d()(),s(22,"td",18)(23,"app-editable-text",23),m("onValueChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.UpdateArticle,o,{link:e}))})("onModeChange",function(e){let o=p(t).rowIndex,i=a();return c(i.onMessage(i.messageType.ChangeEditableMode,o,e?"link":""))}),d()(),F(24,"td",19),d()}if(r&2){let t=u.$implicit,n=u.rowIndex,e=a();O("surface-100",n%2==0),_(2),x("value",t.date)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="date"),_(2),x("value",t.articleType)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="articleType"),_(2),x("value",t.category)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="category"),_(2),x("value",t.author)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="author"),_(2),x("value",t.title)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="title"),_(2),x("value",t.subject)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="subject"),_(1),O("surface-100",n%2==0),_(2),x("value",t.edition)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="edition"),_(2),x("value",t.featured)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="featured"),_(2),x("value",t.source)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="source"),_(2),x("value",t.authorLink)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="authorLink"),_(2),x("value",t.link)("mode",(e.editable==null?null:e.editable.index)==n&&(e.editable==null?null:e.editable.type)=="link")}}var It=(()=>{let u=class u{constructor(){this._store$=P(se),this._scannedActionsSubject$=P(re),this._elementRef=P(X),this.tableValue=[],this.editable={},this.messageType={UpdateArticle:"update article",UploadArticles:"upload articles",ChangeEditableMode:"change editable mode"},this._inproccess=!1,this._subscriptions=[this._scannedActionsSubject$.pipe(de(L.addParsedArticlesSuccess)).subscribe(({existed:n})=>this.tableValue=n)]}onWindowResize(){this._onResize&&typeof this._onResize=="function"&&this._onResize()}get isDisabled(){return this.tableValue.length===0||this._inproccess}fileLoad(n){return B(this,null,function*(){if(!(n&&n.length))return;let e=["","date","articleType","featured","category","source","author","authorLink","title","link","subject","edition","tags"],l=[],o=!0,i=new FileReader;i.onload=Dt=>B(this,[Dt],function*({target:A}){let H=new ve.Workbook;if(A?.result&&(yield H.xlsx.load(A.result),H.worksheets[0].eachRow(h=>{if(o)o=!1;else{let b={};h.eachCell((j,Y)=>{if(e[Y]){let $=e[Y],k=j.text;["date","edition"].includes($)&&(k=(0,Ee.default)(k).format("YYYY-MM-DD"),k==="Invalid Date"&&(k="")),b[$]=k}}),l.push(b)}})),this.tableValue=l.map(h=>N(D({},h),{tags:h.tags?(h.tags??"").split(",").map(b=>b.trim()):[]})),!this._onResize){this._onResize=()=>{let b=this._elementRef.nativeElement.querySelector(".row");if(b){let{height:j}=b.getBoundingClientRect();this.table.virtualScrollItemSize=j}};let h=W([!0]).pipe(q(0)).subscribe(()=>{this._onResize(),h.unsubscribe()})}}),i.readAsArrayBuffer(n[0])})}onMessage(n,e,l){switch(n){case this.messageType.ChangeEditableMode:(e||e===0)&&l?this.editable={index:e,type:`${l}`}:this.editable=void 0;break;case this.messageType.UpdateArticle:{let o=[...this.tableValue];o[e??0]=D(D({},o[e??0]),l),this.tableValue=o,this.editable=void 0}break;case this.messageType.UploadArticles:this._inproccess=!0,this._store$.dispatch(L.addParsedArticles({articles:this.tableValue,callback:o=>{if(o){let{header:i,message:A}=o;this._store$.dispatch(ce.showConfirmDialog({header:i,message:A,accept:{label:"Close"}}))}this._inproccess=!1}}));break;default:break}}ngOnDestroy(){this._subscriptions.forEach(n=>n.unsubscribe())}};u.\u0275fac=function(e){return new(e||u)},u.\u0275cmp=w({type:u,selectors:[["app-excel-uploader"]],viewQuery:function(e,l){if(e&1&&oe(je,5),e&2){let o;ie(o=le())&&(l.table=o.first)}},hostAttrs:[1,"flex","flex-column","overflow-hidden","h-full","settings-page"],hostBindings:function(e,l){e&1&&m("resize",function(i){return l.onWindowResize(i)},!1,K)},standalone:!0,features:[M],decls:6,vars:4,consts:[["scrollHeight","flex",1,"articles-table","w-full","h-full",3,"value","scrollable","virtualScroll","virtualScrollItemSize"],["table",""],["pTemplate","caption"],["pTemplate","summary"],["pTemplate","header"],["pTemplate","body"],[1,"flex","justify-content-end"],["pripple","","type","button",1,"p-ripple","p-element","w-3rem","h-3rem","p-button","p-component","p-button-icon-only","p-button-rounded","p-button-lg","p-button-plain"],[1,"pi","pi-file-excel","text-xl","p-button-icon","ng-star-inserted"],["type","file","accept",".xls,.xlsx",1,"overflow-hidden","max-w-0","max-h-0",3,"change"],["inputFile",""],["icon","pi pi-upload text-xl","styleClass","w-3rem h-3rem","size","large",3,"disabled","rounded","plain","onClick"],[1,""],[1,"article-date-cell"],[1,"px-2"],[1,"article-type-featured-cell"],[1,"article-category-source-cell"],[1,"article-author-cell"],[1,"article-title-cell"],[1,"article-subject-cell"],[1,"row"],["textStyleClass","p-inputtext no-border","inputStyleClass","datepicker-input",3,"value","mode","onValueChange","onModeChange"],["textStyleClass","p-inputtext no-border max-w-full","inputStyleClass","w-12",3,"value","mode","onValueChange","onModeChange"],["textStyleClass","p-inputtext no-border max-w-12","inputStyleClass","w-12",3,"value","mode","onValueChange","onModeChange"]],template:function(e,l){e&1&&(s(0,"p-table",0,1),y(2,Be,5,0,"ng-template",2)(3,Oe,2,4,"ng-template",3)(4,Fe,25,0,"ng-template",4)(5,Le,25,26,"ng-template",5),d()),e&2&&x("value",l.tableValue)("scrollable",!0)("virtualScroll",!0)("virtualScrollItemSize",0)},dependencies:[T,v,Te,Me,S,E,pe,fe,be],styles:["[_nghost-%COMP%]     .article-date-cell{min-width:12rem;max-width:12rem}[_nghost-%COMP%]     .article-type-featured-cell{min-width:10rem;max-width:10rem}[_nghost-%COMP%]     .article-category-source-cell{min-width:10rem;max-width:10rem}[_nghost-%COMP%]     .article-author-cell{min-width:12rem;max-width:12rem}[_nghost-%COMP%]     .article-title-cell{min-width:12rem;max-width:12rem}[_nghost-%COMP%]     .article-subject-cell{min-width:10rem;max-width:10rem}[_nghost-%COMP%]     .table-icon-button.p-button.p-button-icon-only.p-button-rounded{width:1.4rem;height:1.4rem;padding:0;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]     .table-icon-button.p-button.p-button-icon-only.p-button-rounded .p-button-icon{font-size:.5rem}[_nghost-%COMP%]     .p-inputtext{background:transparent}[_nghost-%COMP%]     .p-inputtext.no-border{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]     .no-border{border-color:transparent}"]});let r=u;return r})();export{It as ExcelUploaderComponent};
